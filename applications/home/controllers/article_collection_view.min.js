!function(t,i,e,n,s,a){"use strict";s.ArticleCollectionView=n.View.extend({defaults:{container:"#content",element_space:48},initialize:function(){var n=this;this.settings_deferred=i.getJSON(t.set_path("applications/image_settings.json")),this.settings_deferred.done(function(t){n.settings=i.extend({},t.defaults,t.cover_image)}).always(function(){n.initialize_events()}),this.options=e.extend({},this.defaults,this.options),this.shard_cycle=new t.Cycle(["",1,2,3,4]),this.collection=new this.options.Collection,this.collection.on("reset",this.add_shard_values,this).on("reset",function(){n.settings_deferred.done(function(){n.render_all(),n.fix_sizes(n.breakpoints)})},this).fetch(),this.container=this.options.container,this.$container=i(this.container),this.initial_content=this.$container.html(),this._before_render_all=[],this._after_render_all=[]},initialize_events:function(){var e=this,n=1;for(this.breakpoints=new t.Breakpoints(this.settings),this._current_width=this.breakpoints.width,this.max_size=[],n;n<=this.breakpoints.size;n++)this.max_size.push(n);i(s).on("resize",function(){var i=new t.Breakpoints(e.settings);i.width!==e.breakpoints.width&&(e.breakpoints=i,e._current_width=e.breakpoints.width,e.render_all(),e.fix_sizes(i))})},_get_columns_amount:function(){var t=this.$container.width(),i=Math.round(t/this._current_width),e=i*this._current_width+this.options.element_space*(i-1);return t>=e?i:e>t?i>1?i-1:1:1},fix_sizes:function(t){var e=t.width+"px";i("article > figure > img").css({"max-width":e}),i(".column").css({"max-width":e})},add_shard_values:function(){var t=this;this.collection.each(function(i){i.set({shard:t.shard_cycle.__next__()})},this)},render_one:function(t){t.set({quality:this.breakpoints.settings.quality,width:this.breakpoints.width,height:Math.round(this.breakpoints.width/this.settings.ratio)});var e=new this.options.ModelView({model:t});i("#hidden_container").append(e.render().el)},run_callabacs:function(t){var i=0,e=t.length;if(e)for(i;e>i;i++)t[i]()},before_render_all:function(t){return this._before_render_all.push(t),this},after_render_all:function(t){return this._after_render_all.push(t),this},render_all:function(){this.run_callabacs(this._before_render_all);var t,e=this._get_columns_amount(),n=0;for(this.$container.empty(),n;e>n;++n)i("<div>",{id:"column"+n,"class":"column"}).css("max-width",this.breakpoints.width+"px").appendTo(this.container).after(" ");"undefined"!=typeof this.initial_content&&i("#column0").append(i(this.initial_content)),this.collection.each(this.render_one,this),this.run_callabacs(this._after_render_all),t=i(".column"),i("#hidden_container article").each(function(){var e,n,s=i(this);s.find("img").sizeloaded().one("sizeloaded",function(){t.each(function(){var t=i(this),s=t.height();e===a?(e=s,n=t.attr("id")):e>s&&(e=s,n=t.attr("id"))}),s.detach().appendTo(i("#"+n)).find(".article_item_container figure").css({opacity:0,visibility:"visible"}).animate({opacity:1},"slow")}).one("error",function(){var t=i(this),e=t.attr("src"),n=e.split("http:"),s=n[n.length-1];t.attr("src",s)}),s.find("iframe").one("load",function(){t.each(function(){var t=i(this),s=t.height();e===a?(e=s,n=t.attr("id")):e>s&&(e=s,n=t.attr("id"))}),s.detach().appendTo(i("#"+n)).css({opacity:1,visibility:"visible"}).animate({opacity:1},"slow").find(".article_item_container figure").css({opacity:0,visibility:"visible"}).animate({opacity:1},"slow")})})}})}(helpers,jQuery,_,Backbone,window);