!function(t,i,e,n,s,o){"use strict";s.ArticleCollectionView=n.View.extend({defaults:{container:"#content",element_space:48},initialize:function(){var n=this;this.settings_deferred=i.getJSON(t.set_path("applications/image_settings.json")),this.settings_deferred.done(function(t){n.settings=i.extend({},t.defaults,t.cover_image)}).always(function(){n.initialize_events()}),this.options=e.extend({},this.defaults,this.options),this.shard_cycle=new t.Cycle(["",1,2,3,4]),this.collection=new this.options.Collection,this.collection.on("reset",this.add_shard_values,this).on("reset",function(){n.settings_deferred.done(function(){n.render_all()})},this).fetch(),this.container=this.options.container,this.$container=i(this.container),this.inicial_content=this.$container.html()},initialize_events:function(){var e=this,n=1;for(this.breakpoints=new t.Breakpoints(this.settings),this._current_width=this.breakpoints.width,this.max_size=[],n;n<=this.breakpoints.size;n++)this.max_size.push(n);i(s).on("resize",function(){var i=new t.Breakpoints(e.settings);i.width!==e.breakpoints.width&&(e.render_all(),e.fix_sizes(i),e.breakpoints=i,e._current_width=e.breakpoints.width)})},_get_columns_amount:function(){var t=this.$container.width(),i=Math.round(t/this._current_width),e=i*this._current_width+this.options.element_space*(i-1);return t>=e?i:e>t?i>1?i-1:1:1},fix_sizes:function(t){var e=t.width+"px";i("article > figure > img").css({"max-width":e}),i(".column").css({"max-width":e})},add_shard_values:function(){var t=this;this.collection.each(function(i){i.set({shard:t.shard_cycle.__next__()})},this)},render_one:function(e){var n=new t.Breakpoints(this.settings);e.set({quality:n.settings.quality,width:n.width});var s=new this.options.ModelView({model:e});i("#hidden_container").append(s.render().el),this.fix_sizes(n)},render_all:function(){var e,n=this._get_columns_amount(),s=0,a=new t.Breakpoints(this.settings);for(this.$container.html(""),s;n>s;++s)i("<div>",{id:"column"+s,"class":"column"}).css("max-width",a.width+"px").appendTo(this.container),this.$container.append(" ");"undefined"!=typeof this.inicial_content&&i("#column0").append(this.inicial_content),this.collection.each(this.render_one,this),e=i(".column"),i("#hidden_container article").each(function(){var t,n,s=i(this);s.find("img").sizeloaded().on("sizeloaded",function(){e.each(function(){var e=i(this),s=e.height();t===o?(t=s,n=e.attr("id")):t>s&&(t=s,n=e.attr("id"))}),s.detach().appendTo(i("#"+n)).find(".article_item_container figure").css({opacity:0,visibility:"visible"}).animate({opacity:1},"slow")})})}})}(helpers,jQuery,_,Backbone,window);