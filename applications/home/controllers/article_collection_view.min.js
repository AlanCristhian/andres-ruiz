!function(i,t,e,n,s,a){"use strict";s.ArticleCollectionView=n.View.extend({defaults:{container:"#content",element_space:48},initialize:function(){var n=this;this.settings_deferred=t.getJSON(i.set_path("applications/image_settings.json")),this.settings_deferred.done(function(i){n.settings=t.extend({},i.defaults,i.cover_image)}).always(function(){n.initialize_events()}),this.options=e.extend({},this.defaults,this.options),this.shard_cycle=new i.Cycle(["",1,2,3,4]),this.collection=new this.options.Collection,this.collection.on("reset",this.add_shard_values,this).on("reset",function(){n.settings_deferred.done(function(){n.render_all()})},this).fetch(),this.container=this.options.container,this.$container=t(this.container),this.initial_content=this.$container.html()},initialize_events:function(){var e=this,n=1;for(this.breakpoints=new i.Breakpoints(this.settings),this._current_width=this.breakpoints.width,this.max_size=[],n;n<=this.breakpoints.size;n++)this.max_size.push(n);t(s).on("resize",function(){var t=new i.Breakpoints(e.settings);t.width!==e.breakpoints.width&&(e.render_all(),e.fix_sizes(t),e.breakpoints=t,e._current_width=e.breakpoints.width)})},_get_columns_amount:function(){var i=this.$container.width(),t=Math.round(i/this._current_width),e=t*this._current_width+this.options.element_space*(t-1);return i>=e?t:e>i?t>1?t-1:1:1},fix_sizes:function(i){var e=i.width+"px";t("article > figure > img").css({"max-width":e}),t(".column").css({"max-width":e})},add_shard_values:function(){var i=this;this.collection.each(function(t){t.set({shard:i.shard_cycle.__next__()})},this)},render_one:function(e){var n=new i.Breakpoints(this.settings);e.set({quality:n.settings.quality,width:n.width,height:Math.round(n.width/this.settings.ratio)});var s=new this.options.ModelView({model:e});t("#hidden_container").append(s.render().el),this.fix_sizes(n)},render_all:function(){var e,n=this._get_columns_amount(),s=0,o=new i.Breakpoints(this.settings);for(this.$container.html(""),s;n>s;++s)t("<div>",{id:"column"+s,"class":"column"}).css("max-width",o.width+"px").appendTo(this.container).after(" ");"undefined"!=typeof this.initial_content&&t("#column0").append(t(this.initial_content)),this.collection.each(this.render_one,this),e=t(".column"),t("#hidden_container article").each(function(){var i,n,s=t(this);s.find("img").sizeloaded().on("sizeloaded",function(){e.each(function(){var e=t(this),s=e.height();i===a?(i=s,n=e.attr("id")):i>s&&(i=s,n=e.attr("id"))}),s.detach().appendTo(t("#"+n)).find(".article_item_container figure").css({opacity:0,visibility:"visible"}).animate({opacity:1},"slow")}),s.find("iframe").one("load",function(){e.each(function(){var e=t(this),s=e.height();i===a?(i=s,n=e.attr("id")):i>s&&(i=s,n=e.attr("id"))}),s.detach().appendTo(t("#"+n)).css({opacity:1,visibility:"visible"}).animate({opacity:1},"slow").find(".article_item_container figure").css({opacity:0,visibility:"visible"}).animate({opacity:1},"slow")})})}})}(helpers,jQuery,_,Backbone,window);