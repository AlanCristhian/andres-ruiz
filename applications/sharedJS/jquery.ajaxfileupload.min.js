!function(n){n.fn.ajaxfileupload=function(t){var a={params:{},action:"",onStart:function(){console.log("starting upload"),console.log(this)},onComplete:function(n){console.log("got response: "),console.log(n),console.log(this)},onCancel:function(){console.log("cancelling: "),console.log(this)},validate_extensions:!0,valid_extensions:["gif","png","jpg","jpeg"],submit_button:null},e=!1;return t&&n.extend(a,t),this.each(function(){var t=n(this);if(t.data("ajaxUploader-setup")!==!0){t.change(function(){e=!1,null==a.submit_button&&o()}),null==a.submit_button||a.submit_button.click(function(){e||o()});var o=function(){if(""==t.val())return a.onCancel.apply(t,[a.params]);var o=t.val().split(".").pop().toLowerCase();if(n.extend(a.params,{ext:o}),!0===a.validate_extensions&&-1==n.inArray(o,a.valid_extensions))a.onComplete.apply(t,[{status:!1,message:"The select file type is invalid. File must be "+a.valid_extensions.join(", ")+"."},a.params]);else{e=!0,s(t);var i=a.onStart.apply(t,[a.params]);i!==!1&&t.parent("form").submit(function(n){n.stopPropagation()}).submit()}};t.data("ajaxUploader-setup",!0);var i=function(n,t){var o,i=n.contentWindow.document.body.innerHTML;try{o=JSON.parse(i)}catch(s){o=i}t.siblings().remove(),t.unwrap(),e=!1,a.onComplete.apply(t,[o,a.params])},s=function(t){var e="ajaxUploader-iframe-"+Math.round((new Date).getTime()/1e3);n("body").after('<iframe width="0" height="0" style="display:none;" name="'+e+'" id="'+e+'"/>'),n("#"+e).load(function(){i(this,t)}),t.wrap(function(){return'<form action="'+a.action+'" method="POST" enctype="multipart/form-data" target="'+e+'" />'}).before(function(){var n,t="";for(n in a.params){var e=a.params[n];"function"==typeof e&&(e=e()),t+='<input type="hidden" name="'+n+'" value="'+e+'" />'}return t})}}})}}(jQuery);